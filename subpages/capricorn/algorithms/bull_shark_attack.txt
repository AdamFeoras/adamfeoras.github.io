shark.armor_class = 8
shark.hit_points = 8 + DiceRoll("1d4")
player.armor_class = 10 + skill_check(player.dexterity)
turn_max = DiceRoll("1d6") + 4
for (1, 1, turn_max, 1) {
  player.twenty = DiceRoll("1d20")
  player.attack_roll = player.twenty + player.dagger_quality + skill_check(player.dexterity)
  player.damage_roll = DiceRoll("1d3") + player.dagger_quality + skill_check(player.dexterity)
  shark.twenty = DiceRoll("1d20")
  shark.attack_roll = shark.twenty
  shark.damage_roll = DiceRoll("1d4")
  player.scar_die = DiceRoll("1d4")
  player.scar_placement = ""
  if (player.scar_die = 1) {
    player.scar_placement = "lower right thigh"
  }
  else if (player.scar_die = 2) {
    player.scar_placement = "upper right thigh"
  }
  else if (player.scar_die = 3) {
    player.scar_placement = "lower left thigh"
  }
  else {
    player.scar_placement = "upper left thigh"
  }
  if ((player.hit_points>0) and (shark.hit_points>0)) {
    if ((player.twenty <> 0) and (player.attack_roll > shark.armor_class-1)) {
      if (player.twenty = 20) {
        SetTimeout (5*player.turn_num) {
          msg ("You bring your dagger down into the bull shark's head right as it turns; the opposing force buries the blade deep. The shark tries to wrench away, almost taking your dagger with it, buffeting you with its tail and thrashing in agony as a plume of brilliant red blood blossoms out of its head.")
        }
		player.dexterity = player.dexterity + 1
		player.saltiness = player.saltiness + 1
      }
      else {
        dialogue = DiceRoll("1d4")
        if (dialogue = 1) {
          SetTimeout (5*player.turn_num) {
            msg ("You repeatedly stab the bull shark in the flank as it arcs away to come at you from another angle.")
          }
		  player.dexterity = player.dexterity + 1
        }
        else if (dialogue = 2) {
          SetTimeout (5*player.turn_num) {
            msg ("The bull shark loses its leverage and swims over you. You bury your dagger in its pale belly as it goes.")
          }
		  player.dexterity = player.dexterity + 1
        }
        else if (dialogue = 3) {
          SetTimeout (5*player.turn_num) {
            msg ("The bull shark exposes the side of its head, and you reward this mistake by slashing it down the length of its gills.")
          }
		  player.dexterity = player.dexterity + 1
        }
        else {
          SetTimeout (5*player.turn_num) {
            msg ("You work your dagger through the thick hide of the bull shark's snout as it angrily tries to get leverage on your arm.")
          }
		  player.dexterity = player.dexterity + 1
        }
      }
      if (player.twenty = 20) {
        shark.hit_points = shark.hit_points - 6 - skill_check(player.dexterity) - player.dagger_quality
      }
      else {
        shark.hit_points = shark.hit_points - player.damage_roll
      }
      player.turn_num = player.turn_num + 1
      if (shark.hit_points < 1) {
        SetTimeout (5*player.turn_num) {
          msg ("Baring your teeth, now more angry than frightened, you withdraw your blade and stab down again as the bull shark's movements become sluggish. You slash indiscriminately, abandoning tactics, venting your rage, and your assailant jerks twice, then drifts to the bottom, trailing a billowing red cloud behind it. You surface and scream in pain and triumph.")
			if (player.bloodied = true){
				teeth_num = DiceRoll("1d3")
				collection.shark_teeth = collection.shark_teeth + teeth_num
				player.saltiness = player.saltiness + 1
				msg ("Resting on the beach, you dig " + teeth_num + " shark teeth out of your wounds.")
			}
        }
		player.saltiness = player.saltiness + 1
      }
    }
    else {
      if (player.twenty = 1) {
        SetTimeout (5*player.turn_num) {
          msg ("You lash out with your dagger, but miss, badly, and the bull shark bites down for a second before the blade in its mouth makes it release your hand, which you immediately pull into your chest.")
        }
        player.hit_points = player.hit_points - 1
      }
      else {
        dialogue = DiceRoll("1d2")
        if (dialogue = 1) {
          SetTimeout (5*player.turn_num) {
            msg ("You stab out at the attacking bull shark, but your dagger glances off of its rough hide.")
          }
        }
        else {
          msg ("The bull shark charges and you slash out with your dagger, but it turns at the last moment and you hit nothing but sea water.")
        }
      }
      player.turn_num = player.turn_num + 1
	  if (player.hit_points < 1){
		SetTimeout(5*player.turn_num){
			msg("Trauma and loss of blood makes your head swim. Your vision darkens and the last thing you feel is being shaken and sheared by the predator you failed to overcome.")
			finish
		}
	  }
    }
    if (shark.hit_points>0) {
      if ((shark.twenty <> 1) and (shark.attack_roll > player.armor_class-1)) {
        if (shark.twenty = 20) {
          SetTimeout (5*player.turn_num) {
            msg ("You growl a stream of bubbles as the bull shark gets a vice grip on your inner thigh and shakes you back and forth like a dog, filling the water with so much blood you can barely see your assailant. When it lets you go, you note your leg has gone ice-cold.")
            player.scars = player.scars + "You have a ragged scar on your " + player.scar_placement + " from a shark bite."
          }
        }
        else {
          dialogue = DiceRoll("1d4")
          if (dialogue = 4) {
            SetTimeout (5*player.turn_num) {
              msg ("The bull shark twists through and knocks aside your outstretched arms, savaging your arm for a horrible second before releasing you in an attempt to get a better grip.")
            }
          }
          else if (dialogue = 3) {
            SetTimeout (5*player.turn_num) {
              msg ("The bull shark comes at you low. You kick out wildly, trying to ward it off, but it manages to sink its teeth deep into your calf before you kick it off with your free leg.")
            }
          }
          else if (dialogue = 2) {
            SetTimeout (5*player.turn_num) {
              msg ("The bull shark grabs you by the hip and shakes hard. It's got you in a bony spot and its grip is very good, and it takes a stab in the eye to get it to release you.")
            }
          }
          else {
            SetTimeout (5*player.turn_num) {
              msg ("The bull shark twists through and knocks aside your outstretched arms, savaging your arm for a horrible second before releasing you in an attempt to get a better grip.")
            }
          }
        }
        if (shark.twenty = 20) {
          player.hit_points = player.hit_points - 8
        }
        else {
          player.hit_points = player.hit_points - shark.damage_roll
        }
        player.bloodied = true
        player.turn_num = player.turn_num + 1
        if (player.hit_points <1) {
          SetTimeout (5*player.turn_num) {
            msg ("Trauma and loss of blood makes your head swim. Your vision darkens and the last thing you feel is being shaken and sheared by the predator you failed to overcome.")
            finish
          }
        }
      }
      else {
        if (shark.twenty = 1) {
          shark.hit_points = shark.hit_points - 1
          SetTimeout (5*player.turn_num) {
            msg ("The bull shark charges in blind anger and its angle goes wild. You stab it in the eye as it makes its pass, getting an emphatic shake from the shark as it lines itself up for another go.")
          }
        }
        else {
          dialogue = DiceRoll("1d2")
          if (dialogue = 1) {
            SetTimeout (5*player.turn_num) {
              msg ("The bull shark tries to get a purchase on your body, but you manage to twist away from its gnashing teeth.")
            }
			player.dexterity = player.dexterity + 1
          }
          else {
            SetTimeout (5*player.turn_num) {
              msg ("The bull shark makes a pass at your leg, but its angle is off and you shove it away from you.")
            }
			player.dexterity = player.dexterity + 1
          }
        }
        player.turn_num = player.turn_num + 1
		if (shark.hit_points < 1){
			SetTimeout (5*player.turn_num) {
				msg ("Baring your teeth, now more angry than frightened, you withdraw your blade and stab down again as the bull shark's movements become sluggish. You slash indiscriminately, abandoning tactics, venting your rage, and your assailant jerks twice, then drifts to the bottom, trailing a billowing red cloud behind it. You surface and scream in pain and triumph.")
				if (player.bloodied = true){
					teeth_num = DiceRoll("1d3")
					collection.shark_teeth = collection.shark_teeth + teeth_num
					player.saltiness = player.saltiness + 1
					msg ("Resting on the beach, you dig " + teeth_num + " shark teeth out of your wounds.")
				}
			}
		}
      }
    }
  }
}
if ((player.hit_points > 0) and (shark.hit_points > 0)) {
  SetTimeout (5*player.turn_num) {
    msg ("The water is a boil of bubbles and blood, both you and the bull shark are in a frenzy, both trying to kill the other. With a flick of its tail, the shark turns and hurries away in search of a more compliant meal.")
	if (player.bloodied = true){
		teeth_num = DiceRoll("1d3")
		collection.shark_teeth = collection.shark_teeth + teeth_num
		player.saltiness = player.saltiness + 1
		msg ("Resting on the beach, you dig " + teeth_num + " shark teeth out of your wounds.")
	}
  }
}
shark.hit_points = 8 + DiceRoll("1d4")
player.turn_num = 1