shark.armor_class = 8
shark.hit_die = "1d4"
shark.hit_points = 8 + DiceRoll("1d4")
player.armor_class = 10 + player.dexterity
turn_max = DiceRoll("1d6")
player.turn_num = 1
for (1, 1, turn_max, 1) {
  player.attack_roll = DiceRoll("1d20") + player.dexterity
  player.damage_roll = DiceRoll("1d3") + player.dexterity
  shark.attack_roll = DiceRoll("1d20")
  shark.damage_roll = DiceRoll(shark.hit_die)
  if ((player.hit_points>0) and (shark.hit_points>0)) {
    if (player.attack_roll > shark.armor_class-1) {
	  list add(player.battleLog,"You bury your dagger in the thrashing shark's head for " + player.damage_roll + " points of damage.")
      shark.hit_points = shark.hit_points - player.damage_roll
      if (shark.hit_points < 1) {
	  list add(player.battleLog,"Baring your teeth, now more angry than frightened, you withdraw your blade and stab down again as the shark's movements become sluggish. You slash indiscriminately, abandoning tactics, venting your rage, and your assailant jerks twice, then drifts to the bottom, trailing a billowing red cloud behind it. You surface and scream in pain and triumph.")
      }
    }
    else {
	list add(player.battleLog,"You stab out at the attacking shark, but your dagger glances off of its rough hide.")
    }
    if (shark.hit_points>0) {
      if (shark.attack_roll > player.armor_class-1) {
	  list add(player.battleLog,"The shark twists through and knocks aside your outstretched arms, savaging your body for " + shark.damage_roll + " points of damage.")
        player.hit_points = player.hit_points - shark.damage_roll
        player.bloodied = true
        if (player.hit_points <1) {
		list add(player.battleLog,"Trauma and loss of blood makes your head swim. Your vision darkens and the last thing you feel is being shaken and sheared by the predator you failed to overcome.")
        }
      }
      else {
	  list add(player.battleLog,"The shark tries to get a purchase on your body, but you manage to twist away from it's gnashing teeth.")
      }
    }
  }
}
if ((player.hit_points > 0) and (shark.hit_points > 0)) {
	list add(player.battleLog,"The water is a boil of bubbles and blood, both you and the shark are in a frenzy, both trying to kill the other. With a flick of its tail, the shark turns and hurries away in search of a more compliant meal.")
}

shark.hit_points = 8 + DiceRoll("1d4")

foreach (item, player.battleLog) {
	SetTimeout (5*player.turn_num){
	item = player.battleLog(player.turn_num-1)
	msg(item)
	player.turn_num = player.turn_num + 1
	}
}

if (player.hit_points < 1){
finish
}