if (player.parent.beach=false) {
  msg ("There are no shallows here for you to dive in.")
}
else if (player.time_of_day > 20) {
  msg ("Diving at night is dangerous. Diving in any obscured condition is dangerous.")
}
else if (not Got(dagger)) {
  msg ("You shouldn't dive without your dagger.")
}
else if (player.bloodied=true) {
  msg ("You shouldn't dive when you're bloodied up.")
}
else {
  player.time_of_day = player.time_of_day + 1
  msg ("You strip down to your underwear and neatly fold your clothes on a nearby rock. You wade into the shallows, then dive into the surf when the ledge gives way to water deep enough to dive in.")
  intro_message = DiceRoll("1d6")
  if (intro_message = 1) {
    msg ("You're having a good time, launching yourself around the shallows, vaulting off the bottom, kicking off rocks; the sea is lovely today and your spirits are high.")
  }
  else if (intro_message = 2) {
    msg ("You're having a good time, launching yourself around the shallows, vaulting off the bottom, kicking off rocks; the sea is lovely today and your spirits are high.")
  }
  else if (intro_message = 3) {
    msg ("Resting for a minute, you drift facedown with the tide. Surveying the ocean floor below you like a distant landscape, you catch yourself entertaining the fantasy of being a bird.")
  }
  else if (intro_message = 4) {
    msg ("Resting for a minute, you drift facedown with the tide. Surveying the ocean floor below you like a distant landscape, you catch yourself entertaining the fantasy of being a bird.")
  }
  else if (intro_message = 5) {
    msg ("The shallows are deathly quiet. It's kind of nice; your life feels more compartmentalized down here, but you also feel more isolated. You find yourself thinking of Pipa.")
  }
  else {
    msg ("The shallows are deathly quiet. It's kind of nice; your life feels more compartmentalized down here, but you also feel more isolated. You find yourself thinking of Pipa.")
  }
  disposition = "friendly"
  nature = "mundane"
  if (RandomChance(50)) {
    if (RandomChance(10)) {
      disposition = "hostile"
    }
    if (RandomChance(10)) {
      nature = "mythical"
    }
    if ((disposition = "friendly") and (nature = "mundane")) {
      friendly_mundane = DiceRoll("1d10")
      if (friendly_mundane > 5) {
        msg ("dolphin encounter")
      }
      else if (friendly_mundane > 2) {
        msg ("sea turtle")
      }
      else {
        msg ("octopus")
      }
    }
    else if ((disposition = "friendly") and (nature = "mythical")) {
      msg ("merfolk encounter")
    }
    else {
      if (RandomChance(50)) {
        shark_type = DiceRoll("1d40")
        if (shark_type = 1) {
          if ((DiceRoll("1d20")+skill_check(player.wisdom)) > 9) {
            msg ("You're enjoying the solitude of the shallows as a school of neon blue tangs glide past you. Suddenly, the fish scatter and you the pressure of the water around you seems to intensify slightly. Creeped out, you turn and scream a bouquet of bubbles at an unreasonably large shark swimming fairly close to you.")
            player.wisdom = player.wisdom + 1
            if (DiceRoll("1d4") > 1) {
              msg ("The great white swims off, and then shatters your relief by returning, again sizing you up from  a slight distance. It repeats this behavior a few times before vanishing for good.")
            }
            else {
              msg ("It comes in close, so close that it bumps you as it works itself back and forth. You know you should jab at it with your dagger, but your body won't respond; you're in lockdown mode. Real fear of death paralyzes you as the great white turns and barrels at you with unmistakable intent.")
            }
          }
          else {
            msg ("You're enjoying the solitude of the shallows as a school of neon blue tangs glide past you. ")
            if (DiceRoll("1d4") > 2) {
              msg ("Suddenly, the fish scatter and you are tossed in the wake of something very large. Your butt cheeks come together hard enough to crack a walnut when you see a huge shark with a brilliant white belly swimming away from you. You're shaking and you could dance to the beat of your own heart, but the shark certainly seems like it's decided it isn't interested in you – but you are terrified to realize that it was seriously considering it at one point.")
            }
            else {
              msg ("Suddenly, the fish scatter. A moment later your world explodes as you are launched out of the water. You crash back into the water and pain comes from both sides as you are violently shaken back and forth. Finally, you are momentarily released, too shocked to be as scared as you probably should be when you see your attacker, a massive shark with a brilliant white belly. A great white.")
            }
          }
        }
        else if (shark_type = 2) {
          if ((DiceRoll("1d20")+skill_check(player.wisdom)) > 9) {
            msg ("You're feverishly trying to fish a flustered crab out from underneath a narrow space under a rock when you become aware of something large entering your space. You look up and almost drop your dagger. With its long, spangled body and broad, geometric snout, there's no mistaking a tiger shark.")
            player.wisdom = player.wisdom + 1
            if (DiceRoll("1d3") > 1) {
              msg ("True to form, the tiger shark approaches repeatedly, coming a little closer and faster each time, testing your limits. You back up against a rock face, and as soon as it makes the mistake of coming within arm's reach, you bury your dagger in the side of its face. With a flick of its tale that clouts you hard enough to have you seeing stars, the tiger shark flees for deeper water – which is doubly good, seeing as you've dropped your dagger to the ocean floor and have to bother with retrieving it.")
            }
            else {
              msg ("True to form, the tiger shark approaches repeatedly, coming a little closer and faster each time, testing your limits, and your dagger might as well be a butter knife for all the good it's doing. You even try to swim under a rocky outcropping in an attempt to fend it off. To the aforementioned crab's delight, the shark won't be dissuaded.")
            }
          }
          else {
            if (DiceRoll("1d3") > 2) {
              msg ("You're feverishly trying to fish a flustered crab out from underneath a narrow space under a rock, working your knife in and out of the crevice, as the tasty arthropod gets angrier and angrier. You're utterly absorbed in what you're doing, so much so that you aren't aware you're not alone until something big and rough brushes up against your back. You yelp, kicking and thrashing out at the offending animal. When the silt and bubbles clear, you can make out the stipes of a tiger shark putting you behind him. As soon as you're sure he's gone, you glance back under the rock to discover the crab capitalized on the episode and escaped.")
            }
            else {
              msg ("You're feverishly trying to fish a flustered crab out from underneath a narrow space under a rock when you're lifted away from ocean floor, shearing pressure digging into your side. One glance at the telltale spangling of your attacker tells you you're in the grip of a tiger shark.")
            }
          }
        }
        else if (shark_type = 3) {
          if ((DiceRoll("1d20")+skill_check(player.wisdom)) > 9) {
            msg ("bull shark")
            player.wisdom = player.wisdom + 1
            if (DiceRoll("1d6") > 1) {
              msg ("bull shark")
            }
            else {
              msg ("bull shark")
            }
          }
          else {
            msg ("bull shark")
            if (DiceRoll("1d6") > 2) {
              msg ("bull shark")
            }
            else {
              msg ("bull shark")
            }
          }
        }
        else if (shark_type = 4) {
          msg ("For a brief second, you are alarmed to see a bulky shark come in from deeper water before realizing it's just a sandbar shark. Sandbar sharks don't attack. Ever. But they are famously curious and this one is no exception, shadowing you closely for nearly half an hour – sometimes so close you could reach out and touch it – before losing interest and swimming away.")
        }
        else if (shark_type <= 13) {
          if ((DiceRoll("1d20")+skill_check(player.wisdom)) > 9) {
            msg ("copper shark")
            player.wisdom = player.wisdom + 1
            if (DiceRoll("1d8") > 1) {
              msg ("copper shark")
            }
            else {
              msg ("copper shark")
            }
          }
          else {
            msg ("copper shark")
            if (DiceRoll("1d8") > 2) {
              msg ("copper shark")
            }
            else {
              msg ("copper shark")
            }
          }
        }
        else if (shark_type <= 22) {
          if ((DiceRoll("1d20")+skill_check(player.wisdom)) > 9) {
            msg ("You're engrossed in sifting through the sand, but you don't miss the large shadow approaching from deeper water. Your hopes that it's just a dolphin are dashed when you see the distinct brow of a hammerhead shark come into view.")
            player.wisdom = player.wisdom + 1
            if (DiceRoll("1d6") > 1) {
              msg ("You stay calm and put your back up against a rock, watching the shark watch you. The hammerhead starts making the abrupt turns indicative of an excited shark and for an awful minute you think it's going to attack, but the hammerhead slows back down and eventually leaves the area – though it takes a few more minutes before your pulse returns to normal.")
            }
            else {
              msg ("You swim back away slowly as the shark closes the distance between you, swimming back and forth in your general direction with purpose. It accelerates and starts making jerky, excited turns as it closes in. You grip your dagger hard enough to break your fingers as you and the hammerhead come together.")
            }
          }
          else {
            if (DiceRoll("1d6") > 2) {
              msg ("You're engrossed in sifting through the sand when a shadow falls over you; you look up and give a nasty start to see that a hammerhead has made a slow but close pass at you. Renewing your grip on your dagger, you watch the hammerhead; after a minute of stalking behavior, it swims for deeper water.")
            }
            else {
              msg ("You're engrossed in sifting through the sand when an impact from the side rattles your brain in your skull. You look down and see the iconic skull of a hammerhead with its business end buried in your hip.")
            }
          }
        }
        else if (shark_type <= 31) {
          msg ("A curious blacktip reef shark makes a pass at you from a distance. You've heard of the normally fearful sharks nipping spearfishers to get at their catch, but you're down here for shellfish. You forget about him and don't bothering noticing when he leaves.")
        }
        else {
          msg ("As you go about your business, you notice a sand tiger shark slowly come in and swim over to you. You stay calm, knowing that the snaggletoothed shark looks far more menacing than it is; if you stay calm and don't touch it, it almost certainly won't bother you. Still, you keep any eye on it, and after a minute or so of investigating your activities in the shallows, it carries on swimming around the cove.")
        }
      }
      else {
        enemy_type = DiceRoll("1d10")
        if (enemy_type = 1) {
          if ((DiceRoll("1d20")+skill_check(player.wisdom)) > 14) {
            msg ("You're enjoying yourself, in something of a reverie as you begin to reach into a shadowed hollow, but just in time you see an eel glaring at you. Silently praying a word of thanks, you back up off of the agitated eel and continue your search elsewhere.")
            player.wisdom = player.wisdom + 1
          }
          else if ((DiceRoll("1d20")+skill_check(player.dexterity)) >14) {
            msg ("You're enjoying yourself, in something of a reverie, when you make the mistake of reaching into a concave spot you can't completely see. The head of an eel emerges, and you jerk your hand back just in the nick of time. Your heart is racing and the eel is baring its needle-like fangs, but as you're in one piece, you're calling this a win. You back up off of the agitated eel and continue your search elsewhere.")
            player.dexterity = player.dexterity + 1
          }
          else {
            msg ("You're enjoying yourself, in something of a reverie, when you make the mistake of reaching into a concave spot you can't completely see. You almost inhale a lung full of sea water when an eel lashes out and savages your hand. You rush to the surface, spitting up violently and cradling your maimed hand. Not a good day. Still, it could be worse. At least you didn't lose any fingers.")
            player.bloodied = true
            eel_damage = DiceRoll("1d2")
            player.hit_points = player.hit_points - eel_damage
            msg ("The eel slashed up your hand for " + eel_damage + " points of nonlethal damage.")
            if (player.hit_points <= 0) {
              player.hit_points = 1
            }
          }
        }
        else if (enemy_type = 2) {
          if ((DiceRoll("1d20")+skill_check(player.wisdom)) > 14) {
            msg ("While probing through the rocks in the shallows, you notice one of the rocks has fins and long spines. You steer clear of the nasty little fish, grateful you were lucky enough to notice it before you tried to turn it over.")
            player.wisdom = player.wisdom + 1
          }
          else if ((DiceRoll("1d20")+skill_check(player.dexterity)) >14) {
            msg ("While probing through the rocks in the shallows, you feel a cold stab of panic when one of the rocks moves, but you get your hand out of the way before the rockfish's spines can ruin your day. You watch it swim languidly away for a couple of seconds, comtemplating your close call.")
            player.dexterity = player.dexterity + 1
          }
          else {
            msg ("While probing through the rocks in the shallows, you feel a cold stab of panic when one of the rocks moves and nudges your hand. A flare of breathtaking pain tears up your arm as the rockfish makes its getaway. Staggering onto the beach, you laugh and weep, knowing that the sting's bark is worse than its bite.")
            player.bloodied = true
            if (player.hit_points > 1) {
              player.hit_points = player.hit_points - 1
              msg ("The rockfish jabbed your hand for 1 point of nonlethal damage.")
            }
          }
        }
        else if (enemy_type = 3) {
          if ((DiceRoll("1d20")+skill_check(player.wisdom)) > 9) {
            msg ("As you go back and forth from the surface to the bottom, you fall into a rhythm of kicking off diving down through the surface, kicking off the bottom, dive, kick, dive, kick. With a tasty find in your hand bound for the plate, you wheel around to kick off the bottom again, but at the last moment you spot the sullen eyes of a stingray hidden in the sand. You jerk your legs inward and flapping your arms like a bird, hover away, reminding yourself that thoughtless rhythms are not safe.")
            player.wisdom = player.wisdom + 1
          }
          else if ((DiceRoll("1d20")+skill_check(player.dexterity)) >19) {
            msg ("As you go back and forth from the surface to the bottom, you fall into a rhythm of kicking off diving down through the surface, kicking off the bottom, dive, kick, dive, kick, dive, kick right into a stingray half hidden by the silty sand of the shallows. You and the stingray both thrash around in a panic, but after the dust settles and the ray goes fluttering off, you are pleased to discover a lack of holes in your legs.")
            player.dexterity = player.dexterity + 1
          }
          else {
            msg ("As you go back and forth from the surface to the bottom, you fall into a rhythm of kicking off diving down through the surface, kicking off the bottom, dive, kick, dive, kick, dive, kick right into a stingray half hidden by the silty sand of the shallows. You and the stingray both thrash around in a panic, but in the cloud you're kicking up, you can't see where to go. The barb of the stingray finds the side of your leg, sending you back to the surface and the beach, clutching your leg as the stingray's toxins make your leg cramp up.")
            player.bloodied = true
            ray_damage = DiceRoll("1d3")
            player.hit_points = player.hit_points - ray_damage
            msg ("The ray gouged your leg for " + ray_damage + " points of nonlethal damage.")
            if (player.hit_points <= 0) {
              player.hit_points = 1
            }
          }
        }
        else {
          if ((DiceRoll("1d20")+skill_check(player.wisdom)) > 19) {
            msg ("You're busy looking for fruits of the sea and, by happy chance, you happen to see a jellyfish floating your way. A two second burst of speed from you and the danger bobs harmlessly by.")
            player.wisdom = player.wisdom + 1
          }
          else {
            msg ("You're busy looking for fruits of the sea when you feel a strong burning sensation in your leg. As they're transparent, it would be hard to blame you for not seeing the approaching jellyfish. Already mad before you even lay eyes on the ghostly little wretch, you wrench it off and kick it away. You swim to the bottom and rub the stingers off of the red welt on your leg with a handful of sand.")
          }
        }
      }
    }
  }
  msg ("After an hour or so of looking through the rocks, coral, and flora, you come up with the following: ")
  max = DiceRoll("1d3")
  for (1, 1, max, 1) {
    result = DiceRoll("1d100")
    if (result<51) {
      msg ("a couple of oysters")
      larder.oysters = larder.oysters + 2
    }
    else if (result<76) {
      msg ("a handful of mussels")
      larder.mussels = larder.mussels + 3
    }
    else if (result<91) {
      msg ("a crab")
      larder.crabs = larder.crabs + 1
    }
    else if (result<100) {
      msg ("a lobster")
      larder.lobsters = larder.lobsters + 1
    }
    else {
      msg ("a pearl")
    }
  }
}